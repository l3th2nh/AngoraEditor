	<div class="easyui-layout" fit='true'>	<div data-options="region:'north'" style="height:64px;">		<div style="overflow:hidden">			<select id="animations" class="easyui-combobox" name="anim" style="width:128px"></select>			<a id="addAnim" class="easyui-linkbutton" data-options="iconCls:'icon-ae-add'" style="border:none"></a>			<a id="removeAnim" class="easyui-linkbutton" data-options="iconCls:'icon-ae-remove'" style="border:none"></a>		</div>	</div>	<div data-options="region:'center'" >		<div id='container' style="position:relative;">			<img id="atlas" ></img>			<div id="animrect" style="position:absolute;left:0;top:0;border:1px solid red;height:16px;width:16px;"></div>		</div>	</div>	<div data-options="region:'east'" style="width:150px;">		<div id="animeproperty">property</div>	</div>	<div data-options="region:'south'" style="height:64px;">		<button id="btn_ok" style="float:left;margin-top:10px;">OK</button>		<button id="btn_cancel" style="float:right;margin-top:10px;">Cancel</button>	</div>	</div>	<script>	$(document).ready(function(){		var editor=edt;		var spritesheet=editor.res.get(editor.node.selected.image);		var path=editor.project.currentProject.path+"/"+spritesheet.path;		$('#atlas').attr('src',path);		var rows=parseInt(spritesheet.Yframe);		var cols=parseInt(spritesheet.Xframe);		var w=spritesheet.width/spritesheet.Xframe;		var h=spritesheet.height/spritesheet.Yframe;		var animations=editor.node.selected.animations;		var comboxValues=[];		var currentAnim=null;		var index=0;		for(key in animations){			//$('#animations').append("<option value='{0}'>{0}</option>".format(key)); 			comboxValues.push({'text':key,'value':key});		}		$('#animations').combobox({			valueField: 'value',			textField: 'text',			data : comboxValues,			onSelect: function(record){				currentAnim=record.value;				var anim=animations[record.value];				$('#animeproperty').propertygrid('loadData',[					{"name":"framRate","value":anim.frameRate,"editor":"numberbox"},					{"name":"loop","value":anim.loop,"editor":{"type":"checkbox","options":{"on":true,"off":false}}},					{"name":"sequence","value":anim.sequence.toString(),"editor":"text"}				]);			}		});		$('#animrect').css({width:w,height:h});		$('#animeproperty').propertygrid({			data : '',			onEndEdit : function (index, field, changes) {				var name = field['name'];				var value = field['value'];				switch (name) {				case 'sequence':					try{						animations[currentAnim].sequence=JSON.parse("["+value+"]");					}catch(e){						field['value']=animations[currentAnim].sequence.toString();					}				default:					animations[currentAnim][name]=value;					break;				}			}		});		$('#atlas').mousemove(function(e){			var dposleft=$('#dd').dialog('dialog')[0].offsetLeft;			var dpostop=$('#dd').dialog('dialog')[0].offsetTop;			var cpos=$('#atlas').position();			var spos=$('#container').parent().scrollTop();			var left=Math.max(0,Math.floor((e.pageX-dposleft-w/2)/w)*w);			var top=Math.max(0,Math.floor((e.pageY-dpostop-64-h/2+spos)/h)*h);			$('#animrect').css({left:left,top:top});			index=top/h*cols+left/w;		});		$('#addAnim').click(function(){			var name=prompt('Enter animation name','anim');			currentAnim=name;			animations[currentAnim]={frameRate:60,loop:true,sequence:[]};			//comboxValues.push(name);			//$('#animations').combobox('setValues', comboxValues);			//$('#animations').append("<option value='{0}'>{0}</option>".format(name)); 			comboxValues.push({'text':name,'value':name});			$('#animations').combobox('loadData', comboxValues);			$('#animations').combobox('select', name);			/*$('#animeproperty').propertygrid('loadData',[				{"name":"framRate","value":60,"editor":"numberbox"},				{"name":"loop","value":true,"editor":{"type":"checkbox","options":{"on":true,"off":false}}},				{"name":"sequence","value":"","editor":"text"}			]);*/		});		$('#animrect').click(function(){			if(currentAnim!=null){				animations[currentAnim].sequence.push(index);				$('#animeproperty').propertygrid('updateRow',{					index: 2,					row: {						value:animations[currentAnim].sequence.toString()					}				});			}		});		$("#btn_ok").click(function(){			//editor.res.anim=animations;			editor.attr.setAttr(editor.node.selected,'animations',animations);			$('#dd').dialog('close');		});		$("#btn_cancel").click(function(){			$('#dd').dialog('close');		});	});	</script>